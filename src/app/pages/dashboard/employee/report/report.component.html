<shared-on-success-alert [message]="successMessage"></shared-on-success-alert>
<shared-on-error-alert [message]="errorMessage"></shared-on-error-alert>
<mat-toolbar class="header" color="primary">
  <mat-toolbar-row>
    <span>Workforce Reports</span>
    <span class="fill-remaining-space"></span>
    <button mat-icon-button
            matTooltip="TO DOWNLOAD A REPORT PLEASE SELECT THE FILTER OPTIONS, LEAVING A FILTER EMPTY MEANS IT HAS NO FILTER">
      <mat-icon>help</mat-icon>
    </button>
  </mat-toolbar-row>
  <mat-toolbar-row *ngIf="!this.dataSource"> </mat-toolbar-row>
  <mat-toolbar-row *ngIf="!this.dataSource"> </mat-toolbar-row>
</mat-toolbar>
<div class="mat-card-top" *ngIf="!this.dataSource">
  <mat-card class="pa-1">
    <div fxLayout="column" fxLayoutAlign="start">
      <form fxLayout="row" fxLayoutAlign="space-around" fxLayoutGap="5px" class="pa-1" [formGroup]="reportForm">
        <mat-form-field appearance="fill" [formGroup]="queryForm">
          <mat-label>STATUS</mat-label>
          <mat-select formControlName="status" multiple placeholder="NO FILTER">
            <mat-select-trigger>
              <mat-chip-list>
                <mat-chip *ngFor="let status of queryForm.controls['status'].value"
                          [removable]="true" (removed)="onFilterRemoved(status, 'status')">
                  {{ status === "" ? 'NO FILTER' : status | uppercase }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </mat-select-trigger>
            <mat-option *ngFor="let item of status" [value]="item.value">
              {{ item.viewValue | uppercase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" [formGroup]="queryForm">
          <mat-label>CLIENT</mat-label>
          <mat-select formControlName="client" multiple placeholder="NO FILTER"
                      (selectionChange)="setCampaigns($event.value)">
            <mat-select-trigger>
              <mat-chip-list>
                <mat-chip *ngFor="let client of queryForm.controls['client'].value"
                          [removable]="true" (removed)="onFilterRemoved(client, 'client')">
                  {{  client.name === "" ? 'NO FILTER' : client.name | uppercase }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </mat-select-trigger>
            <mat-option *ngFor="let item of clients" [value]="item">
              {{ item.name | uppercase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" [formGroup]="queryForm">
          <mat-label>CAMPAIGN</mat-label>
          <mat-select formControlName="campaign" multiple placeholder="NO FILTER">
            <mat-select-trigger>
              <mat-chip-list>
                <mat-chip *ngFor="let campaign of queryForm.controls['campaign'].value"
                          [removable]="true" (removed)="onFilterRemoved(campaign,'campaign')">
                  {{ campaign === "" ? 'NO FILTER' : campaign | uppercase }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </mat-select-trigger>
            <mat-option *ngFor="let item of campaigns" [value]="item.name">
              {{ item.name | uppercase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>
      <form fxLayout="row" fxLayoutGap="5px" class="px-1" [formGroup]="queryForm">
        <mat-form-field
          appearance="fill"
        >
          <mat-label>MANAGER</mat-label>
          <mat-select
            placeholder="MANAGER"
            formControlName="manager"
          >
            <mat-option
              *ngFor="let item of superiors?.managers"
              [value]="item"
            >
              {{ item?.name | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field
          appearance="fill"
        >
          <mat-label>SHIFT MANAGER</mat-label>
          <mat-select
            placeholder="SHIFT MANAGER"
            formControlName="shiftManager"
          >
            <mat-option
              *ngFor="let item of superiors?.shiftManagers"
              [value]="item"
            >
              {{ item?.name | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field
          appearance="fill"
        >
          <mat-label>SUPERVISOR</mat-label>
          <mat-select
            placeholder="SUPERVISOR"
            formControlName="supervisor"
          >
            <mat-option
              *ngFor="let item of superiors?.shiftManagers"
              [value]="item"
            >
              {{ item?.name | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field
          appearance="fill"
        >
          <mat-label>TRAINER</mat-label>
          <mat-select
            placeholder="TRAINER"
            formControlName="trainer"
          >
            <mat-option
              *ngFor="let item of superiors?.trainers"
              [value]="item"
            >
              {{ item?.name | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill" [formGroup]="queryForm" floatLabel="always">
          <mat-label>TRAINING GROUP</mat-label>
          <span matPrefix>GEN&nbsp;</span>
          <input
            matInput
            placeholder="GROUP #"
            formControlName="trainingNo"
            type="number"
          />
        </mat-form-field>
      </form>
      <form fxLayout="row" fxLayoutAlign="start" fxLayoutGap="20px" class="px-1" [formGroup]="reportForm">
        <mat-form-field appearance="fill" *ngIf="reportForm.controls.hireDateCheck.value" [formGroup]="queryForm">
          <mat-label>HIRE DATE</mat-label>
          <input matInput
                 placeholder="CLICK ON CALENDAR"
                 [satDatepicker]="hireDatePicker"
                 formControlName="hireDate">
          <sat-datepicker
            #hireDatePicker
            [rangeMode]="true"
            [calendarFooterComponent]="rangesFooter"
          ></sat-datepicker>
          <sat-datepicker-toggle matSuffix [for]="hireDatePicker"></sat-datepicker-toggle>
          <button class="picker-toggle-button" matPrefix mat-icon-button color="primary"
                  (click)="reportForm.controls.hireDateCheck.setValue(false)">
            <mat-icon>indeterminate_check_box</mat-icon>
          </button>
        </mat-form-field>
        <mat-checkbox formControlName="hireDateCheck" value="" color="primary"
                      *ngIf="!reportForm.controls.hireDateCheck.value">
          <span>HIRE DATE</span>
        </mat-checkbox>

        <mat-form-field appearance="fill" *ngIf="reportForm.controls.terminationDateCheck.value"
                        [formGroup]="queryForm">
          <mat-label>TERMINATION DATE</mat-label>
          <input matInput
                 placeholder="CLICK ON CALENDAR"
                 [satDatepicker]="termDatePicker"
                 formControlName="terminationDate">
          <sat-datepicker
            #termDatePicker
            [rangeMode]="true"
            [calendarFooterComponent]="rangesFooter"
          ></sat-datepicker>
          <sat-datepicker-toggle matSuffix [for]="termDatePicker"></sat-datepicker-toggle>
          <button class="picker-toggle-button" matPrefix mat-icon-button color="primary"
                  (click)="reportForm.controls.terminationDateCheck.setValue(false)">
            <mat-icon>indeterminate_check_box</mat-icon>
          </button>
        </mat-form-field>
        <mat-checkbox formControlName="terminationDateCheck" value="" color="primary"
                      *ngIf="!reportForm.controls.terminationDateCheck.value">
          <span>TERMINATION DATE</span>
        </mat-checkbox>
      </form>
    </div>

    <mat-card-header>
      <mat-card-subtitle>
        Choose the information you want to export (default - only main
        information will be exported)
      </mat-card-subtitle>
    </mat-card-header>
    <div fxLayout="row" fxLayoutAlign="center stretch" fxLayoutGap="1px">
      <mat-button-toggle
        (click)="clickMain($event)"
        [checked]="mainInfoToggle"
        matTooltip="Information such as: names, social security...etc"
      >
        Main Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickCompany($event)"
        matTooltip="Information such as: campaign, hire date...etc"
      >
        Company Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickPosition($event)"
        matTooltip="Information such as: department, position, position dates...etc"
      >
        Position Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickShift($event)"
        matTooltip="Information such as: shift...etc"
      >
        Shift Information
      </mat-button-toggle>
    </div>

    <div fxLayout="row" fxLayoutAlign="center stretch" fxLayoutGap="1px">
      <mat-button-toggle
        (click)="clickPersonal($event)"
        matTooltip="Information such as: address, email, phone...etc"
      >
        Personal Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickComments($event)"
        matTooltip="Information such as: comments ...etc"
      >
        Comments Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickAttrition($event)"
        matTooltip="Information such as: attrition...etc"
      >
        Attrition Information
      </mat-button-toggle>
      <mat-button-toggle
        (click)="clickEmergency($event)"
        matTooltip="Information such as: emergency contact...etc"
      >
        Emergency Information
      </mat-button-toggle>
    </div>

    <button
      mat-button
      color="primary"
      (click)="getReport()"
      *ngIf="!this.dataSource"
    >
      <mat-icon>cached</mat-icon>&nbsp; &nbsp; LOAD INFORMATION
    </button>
  </mat-card>

  <mat-card>
    <mat-card-header>
      <mat-card-title>
        Available Information Report
      </mat-card-title>
      <mat-card-subtitle>
        Filter > Analyze > Fix
      </mat-card-subtitle>
    </mat-card-header>
    <mat-tab-group (selectedTabChange)="tabChanged($event)">
      <mat-tab label="PROFILE PICTURE">
        <app-available-information
          [focused]="this.selectedTab === 0"
          [query]="this.avatarQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="MAIN">
        <app-available-information
          [focused]="this.selectedTab === 1"
          [query]="this.mainQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="COMPANY">
        <app-available-information
          [focused]="this.selectedTab === 2"
          [query]="this.companyQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="SHIFT">
        <app-available-information
          [focused]="this.selectedTab === 3"
          [query]="this.shiftQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="POSITION">
        <app-available-information
          [focused]="this.selectedTab === 4"
          [query]="this.positionQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="PAYROLL">
        <app-available-information
          [focused]="this.selectedTab === 5"
          [query]="this.payrollQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="PERSONAL">
        <app-available-information
          [focused]="this.selectedTab === 6"
          [query]="this.personalQuery"
        ></app-available-information>
      </mat-tab>
      <mat-tab label="EMERGENCY CONTACT">
        <app-available-information
          [focused]="this.selectedTab === 7"
          [query]="this.familyQuery"
        ></app-available-information>
      </mat-tab>
    </mat-tab-group>
  </mat-card>
</div>

<div class="pa-1" *ngIf="this.dataSource">
  <mat-card-header>
    <mat-card-title>Data Preview</mat-card-title>
    <mat-card-subtitle
      >to export to Excel click on the export button
    </mat-card-subtitle>
  </mat-card-header>
  <div class="container">
    <table mat-table #table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="employeeId">
        <mat-header-cell *matHeaderCellDef>Employee ID</mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.employeeId }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="firstName">
        <mat-header-cell *matHeaderCellDef>First Name</mat-header-cell>
        <mat-cell *matCellDef="let element"> {{ element.firstName }} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="middleName">
        <mat-header-cell *matHeaderCellDef>Middle Name</mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.middleName }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="lastName">
        <mat-header-cell *matHeaderCellDef>Last Name</mat-header-cell>
        <mat-cell *matCellDef="let element"> {{ element.lastName }} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="gender">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Gender
        </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{ element.gender }} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="socialSecurity">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Social Security
        </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.socialSecurity }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          Status
        </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{ element.status }}</mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns"></mat-row>
    </table>
  </div>
  <br />
  <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="gappx">
    <button mat-button color="primary" (click)="export()">
      <mat-icon>cloud_download</mat-icon>&nbsp; &nbsp; EXPORT
    </button>
    <div class="fill-remaining-space"></div>
    <button mat-button color="warn" (click)="clear()">
      <mat-icon>clear</mat-icon>&nbsp; &nbsp; CLEAR
    </button>
  </div>
</div>
